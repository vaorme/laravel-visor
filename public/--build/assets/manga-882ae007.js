import{d as ne,r as re,c as U,M as ie}from"./helpers-27e9ade0.js";import{s as F,a as f,r as S,b as le}from"./helpers-cf980081.js";let se=["jpg","jpeg","png","webp","gif"];ne(".fm-manga .dropzone #choose",se);const O={silent:!0,allowHTML:!0,removeItems:!0,removeItemButton:!0,searchEnabled:!1,searchFloor:1,position:"auto",resetScrollPosition:!0,searchResultLimit:2,searchFields:["label","value"],duplicateItemsAllowed:!1,addItemText:t=>`Presiona Enter para añadir <b>"${t}"</b>`,position:"auto",loadingText:"Cargando...",noResultsText:"No se han encontrado resultados",noChoicesText:"No hay opciones para elegir",itemSelectText:"Presione para seleccionar",uniqueItemText:"Solo se pueden agregar valores únicos",customAddItemText:"Solo se pueden agregar valores que coincidan con condiciones específicas"},G=document.querySelector("#m-tags"),J=document.querySelector("#m-categories"),V=document.querySelector("#m-mangatype"),Z=document.querySelector("#m-bookstatus"),Q=document.querySelector("#m-demography");G&&J&&V&&Z&&Q&&(new Choices(G,O),new Choices(J,O),new Choices(V,O),new Choices(Z,O),new Choices(Q,O));let ce=document.querySelector("#field-date");ce&&new AirDatepicker("#field-date",{locale:localeEs,dateFormat:"yyyy-MM-dd"});let de=document.querySelector(".fm-create");if(de){let t=document.querySelector("#m-name"),a=document.querySelector("#m-slug");t.addEventListener("input",function(s){a.value=F(s.target.value)}),a.addEventListener("input",function(s){a.value=F(s.target.value)})}let ue=document.querySelector(".fm-update");if(ue){let t=document.querySelector("#m-slug");t.addEventListener("input",function(a){t.value=F(a.target.value)})}let j=document.getElementById("modalChapter");if(j){let t=document.querySelector("#ct-name"),a=document.querySelector("#ct-slug");document.querySelector("#ct-images"),document.querySelectorAll('#modalChapter form input[name="chaptertype"]'),document.querySelector("main.main .box .frmo.fm-manga .main .section.chapters .buttons a#ct-chapter").addEventListener("click",function(e){e.preventDefault(),tinymce.init({selector:"#createChapterContent",plugins:"anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount",toolbar:"undo redo | blocks fontfamily fontsize backcolor | bold italic underline strikethrough | link image media table | align lineheight | numlist bullist indent outdent | emoticons charmap | removeformat",menubar:!1,height:600}),f(j,"opn"),re()}),document.addEventListener("click",function(e){e.target.matches("#modalChapter .md-close")&&(e.preventDefault(),tinymce.remove(),f(j,"clg"),S(j,"opn"),U())});let c=document.querySelector("#t-preview"),o=document.querySelectorAll("main.main .box #modalChapter .md-content form .group .radios label input"),p=document.querySelector("#t-manga"),y=document.querySelector("#t-novel");o.forEach(e=>{e.addEventListener("click",function(i){i.target.value=="novel"&&(f(p,"hidden"),S(y,"hidden")),i.target.value=="manga"&&(f(y,"hidden"),S(p,"hidden"))})});let D=document.querySelector("#modalChapter form");t.addEventListener("input",function(e){a.value=F(e.target.value)}),a.addEventListener("input",function(e){a.value=F(e.target.value)});let l=[],L=["jpeg","jpg","png","gif"];const g=function(e,i){const d=document.querySelector(e);let u;d&&(u=d.nextElementSibling,u.addEventListener("change",function(m){l.push(...m.target.files),l.length>0&&(l=h(l,i),Y(l),console.log(l))}),d.addEventListener("click",()=>u.click()),d.addEventListener("dragover",m=>{m.preventDefault()}),d.addEventListener("drop",m=>{m.preventDefault(),l.push(...m.dataTransfer.files),l.length>0&&(l=h(l,i),Y(l))}))},h=function(e,i){let d=[];if(!e)return console.log("error, no hay archivos"),[];for(let u=0;u<e.length;u++){let m=e[u].name.split(".").pop().toLowerCase();if(!i.includes(m)){console.log(e[u].name,"Tipo de archivo no permitido");continue}d.push(e[u])}return d};g("#modalChapter #t-preview .choose",L);const k=new DgSortable(c,{draggable:".item",mirror:{constrainDimensions:!0}});Array.prototype.movePreview=function(e,i){console.log(this),this.splice(i,0,this.splice(e,1)[0]);for(let d=0;d<this.length;d++){let u=this[d].name.split("."),m=Date.now()+d;u[0].replace(/[0-9-]/g,`${d}-`),this[d]=new File([this[d]],`${d}-${m}.${u[1]}`)}},k.on("sortable:sorted",e=>{let i=e.data.newIndex,d=e.data.oldIndex;l.movePreview(d,i),console.log(l)}),k.on("sortable:stop",()=>{setTimeout(()=>{let e=document.querySelectorAll("#modalChapter .md-content form .group #t-preview .item");for(let i=0;i<e.length;i++)e[i].setAttribute("id","image-"+i),e[i].setAttribute("index",i),e[i].children[1].setAttribute("data-index",i)},300)});const T=function(e,i){document.querySelector("#image-"+i).remove();let u=document.querySelectorAll("#modalChapter .md-content form .group #t-preview .item");e.splice(i,1);for(let m=0;m<e.length;m++){let $=e[m].name.split("."),B=Date.now()+m;$[0].replace(/[0-9-]/g,`${m}-`),u[m].setAttribute("id","image-"+m),u[m].setAttribute("index",m),u[m].children[1].setAttribute("data-index",m),e[m]=new File([e[m]],`${m}-${B}.${$[1]}`)}return e};document.addEventListener("click",function(e){if(!e.target.matches(".c-remove"))return;e.preventDefault();let i=e.target.getAttribute("data-index");l=T(l,i)}),D.addEventListener("submit",async function(e){if(e.preventDefault(),t.value=="")return t.focus(),f(t,"error"),Toastify({text:"Campo nombre requerido",className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!0;if(S(t,"error"),a.value=="")return a.focus(),f(a,"error"),Toastify({text:"Campo slug requerido",className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!0;S(a,"error");let i=document.querySelector("#modalChapter form"),d=document.querySelector(".fm-manga form .chapters .list .simplebar-content"),u=new FormData(i),m=u.get("_token"),$=u.get("manga_id"),B=u.get("name"),r=u.get("slug"),n=u.get("disk"),v=u.get("chaptertype"),w=u.get("price"),b=tinymce.get("createChapterContent").getContent(),_=document.querySelector("#modalChapter .radios input:checked");if(_.value=="manga"){if(l.length<1)return Toastify({text:"Debes agregar una imagen por lo menos.",className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!0}else if(_.value=="novel"&&b=="")return Toastify({text:"Contenido no debe ir vacio",className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!0;u.append("content",JSON.stringify(b));let q=u.get("content");await axios.post(route("createChapter.store",[$]),{_token:m,name:B,slug:r,price:w,disk:n,chaptertype:v,content:q},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"multipart/form-data"}}).then(function(C){let x=C.data;if(x.excluded&&x.excluded.forEach(W=>{Toastify({text:W,className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"bottom",position:"right"}).showToast()}),C.data.status=="success"){const{id:M,manga_id:W}=C.data.item;new Promise(async(N,E)=>{const A=Object.values(l);if(A.length>0){let I=0;for(const z of A){const H=document.querySelector("#image-"+I);f(H.children[1],"spin"),await axios.post(route("uploadSingle.store"),{chapter_id:M,manga_id:W,disk:n,image:z},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"multipart/form-data"}}).then(function(P){console.log(P),P.data.status=="success"&&(f(H.children[1],"uploaded"),H.children[1].innerHTML='<i class="fa-solid fa-check"></i>')}).catch(function(P){console.log("error: ",P)}),console.log(I),I===A.length-1&&N(),I++}}else N()}).then(()=>{Toastify({text:C.data.msg,className:"success",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast();let N=C.data.item,E=C.data.manga_slug,A=document.createElement("div");A.classList.add("item"),A.setAttribute("id","m-"+N.id),A.innerHTML=`
                        <div class="name">
                            ${N.name}
                        </div>
                        <div class="actions">
                            <a href="${route("chapter_viewer.index",{manga_slug:E,chapter_slug:N.slug})}" data-id="${N.id}" class="botn view" target="_blank">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-player-play" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                    <path d="M7 4v16l13 -8z" />
                                </svg>
                            </a>
                            <a href="#" data-id="${N.id}" class="botn edit">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-pencil" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                    <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
                                    <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
                                </svg>
                            </a>
                            <a href="#" data-id="${N.id}" class="botn delete">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-trash" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                    <line x1="4" y1="7" x2="20" y2="7" />
                                    <line x1="10" y1="11" x2="10" y2="17" />
                                    <line x1="14" y1="11" x2="14" y2="17" />
                                    <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" />
                                    <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
                                </svg>
                            </a>
                        </div>
                    `,d.append(A),setTimeout(function(){l=[],K(),U(),i.reset(),tinymce.remove(),S(p,"hidden"),f(y,"hidden"),S(j,"opn")},1e3)})}else C.data.status=="error"&&Toastify({text:C.data.msg,className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"bottom",position:"right"}).showToast()}).catch(function(C){console.log("error: ",C)})})}function Y(t){K();let a=document.querySelector("#t-preview"),s=document.querySelector("#t-preview .item:last-of-type"),c;s?c=Number(s.getAttribute("index"))+1:c=0;for(let o=0;o<t.length;o++){let p=URL.createObjectURL(t[o]),y=document.createElement("div"),D=c+o;f(y,"item"),y.setAttribute("id","image-"+D),y.setAttribute("index",D),y.innerHTML=`
            <img src="${p}" alt="preview" />
            <div class="up-status">
                <i class="fa-solid fa-circle-notch"></i>
            </div>
            <div class="c-remove" data-index="${D}">
                <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
            </div>
        `,a.append(y)}}function K(){let t=document.querySelectorAll("#t-preview .item");t&&t.forEach(a=>{a.remove()})}const ee=document.querySelector(".frmo.fm-manga .main .section.chapters .buttons a#popup-chapter");if(ee){const t=document.querySelector(".frmo.fm-manga .main .section.chapters .chapter__upload");ee.addEventListener("click",function(a){a.preventDefault(),le(t)})}let me=["zip"];pe(".fm-manga .upload #upload-chapter",me);function pe(t,a){const s=document.querySelector(t);let c;s&&(c=s.nextElementSibling,c.addEventListener("change",function(o){const p=this.files[0];te(p,a)}),s.addEventListener("click",()=>c.click()),s.addEventListener("dragover",o=>{o.preventDefault()}),s.addEventListener("drop",o=>{o.preventDefault(),console.log(o.dataTransfer.files);const p=o.dataTransfer.files[0];te(p,a)}))}function te(t,a){if(!t)return console.log("error, no hay archivo"),"error";let s=t.name.split(".").pop().toLowerCase();if(!a.includes(s))return alert("Tipo de archivo no permitido"),"no allowed";let o=document.querySelector("#inpt-chapter").getAttribute("data-id"),p=new FormData,y=document.querySelector(".fm-manga form .chapters .list .simplebar-content"),D=document.querySelector(".frmo.fm-manga .main .section.chapters .chapter__upload .disks input:checked");p.set("disk",D.value),p.append("chapters",t);let l=document.querySelector(".fm-manga .u__bar"),L=document.querySelector(".fm-manga .u__bar .u__progress");axios.post(route("uploadChapter.store",[o]),p,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},onUploadProgress:g=>{const h=g.loaded/g.total*95;l.style.display="block",L.style.width=h+"%"}}).then(function(g){let h=g.data;h.excluded&&h.excluded.forEach(e=>{Toastify({text:e,className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"bottom",position:"right"}).showToast()});let k=h.created;if(k)k.forEach(T=>{Toastify({text:T.msg,className:"success",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast()}),k.forEach(T=>{let e=T.item,i=T.manga_slug,d=document.createElement("div");d.classList.add("item"),d.setAttribute("id","m-"+e.id),d.innerHTML=`
                    <div class="name">
                        ${e.name}
                    </div>
                    <div class="actions">
                        <a href="${route("chapter_viewer.index",{manga_slug:i,chapter_slug:e.slug})}" data-id="${e.id}" class="botn view" target="_blank">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-player-play" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M7 4v16l13 -8z" />
                            </svg>
                        </a>
                        <a href="#" data-id="${e.id}" class="botn edit">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-pencil" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
                                <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
                            </svg>
                        </a>
                        <a href="#" data-id="${e.id}" class="botn delete">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-trash" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <line x1="4" y1="7" x2="20" y2="7" />
                                <line x1="10" y1="11" x2="10" y2="17" />
                                <line x1="14" y1="11" x2="14" y2="17" />
                                <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" />
                                <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
                            </svg>
                        </a>
                    </div>
                `,y.append(d)});else{let T=g.data.error;T&&T.forEach(e=>{Toastify({text:e,className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"bottom",position:"right"}).showToast()})}document.querySelector("#inpt-chapter").value="",L.style.width="100%",setTimeout(()=>{l.style.display="none",L.style.width=0},300)}).catch(function(g){console.log(g)})}let R=new ie;document.addEventListener("click",function(t){if(!t.target.matches(".mangaDelete"))return;t.preventDefault();let a=t.target.getAttribute("data-id");R.fire({type:"warning",title:"Seguro que deseas eliminar?",text:"¡No podrás revertir esto!",confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"}).then(s=>{s.confirmed&&axios.delete(route("manga.destroy",[a]),{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(c){Toastify({text:c.data.msg,className:"success",duration:1e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast();let o=document.querySelector(".alertify"),p=document.querySelector(".al-overlay");R.close(o,p),setTimeout(()=>{window.location.href=route("manga.index")},1e3)}).catch(function(c){console.log(c)})}).catch(s=>{console.log(s)})});document.querySelectorAll("main.main .box .frmo.fm-manga .main .section.chapters .list .item .actions .botn.delete");document.addEventListener("click",function(t){if(!t.target.matches(".botn.delete"))return;t.preventDefault();let a=t.target.getAttribute("data-id");R.fire({type:"warning",title:"Eliminar capítulo?",text:"¡No podrás revertir esto!",confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"}).then(s=>{s.confirmed&&axios.delete(route("chapters.destroy",[a]),{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(c){Toastify({text:c.data.msg,className:"success",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast();let o=document.querySelector(".alertify"),p=document.querySelector(".al-overlay");R.close(o,p),document.querySelector("#m-"+c.data.id).remove()}).catch(function(c){console.log(c)})}).catch(s=>{console.log(s)})});document.addEventListener("click",function(t){if(!t.target.matches(".botn.edit"))return;t.preventDefault();let a=t.target.getAttribute("data-id"),s=document.querySelector('meta[name="csrf-token"]').getAttribute("content");axios.post(route("chapters.show",[a]),{headers:{"X-CSRF-TOKEN":s}}).then(function(c){if(re(),c.status==200){let{chapter:o}=c.data,p=document.querySelector(".main.main .box"),y=document.createElement("div");const D=o.disk;let l=[];o.images&&(l=JSON.parse(o.images));let L=document.querySelector("#u-preview .item:last-of-type"),g;L?g=Number(L.getAttribute("index"))+1:g=0,y.setAttribute("id","updateChapter"),f(y,"modal-chapter opn");let h;switch(D){case"ftp":h="https://s3.imgs-knight.xyz/";break;case"sftp":h={}.VITE_SFTP_URL;break;case"s3":h={}.VITE_S3_URL;break;default:h="http://localhost:8000/storage/";break}y.innerHTML=`
                <div class="md-title">
                    <h4>Actualizar capítulo</h4>
                    <div class="md-close">
                        <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                    </div>
                </div>
                <div class="md-content">
                    <form action="${route("chapters.update",[o.id])}" method="post" enctype="multipart/form-data">
                        <input type="hidden" name="_token" value="${s}">
                        <input type="hidden" name="manga_id" value="${o.manga_id}">
                        <div class="group">
                            <label for="ct-name">Name</label>
                            <input type="text" name="name" id="ct-name" value="${o.name}">
                        </div>
                        <div class="group">
                            <label for="ct-slug">Slug</label>
                            <input type="text" name="slug" id="ct-slug" value="${o.slug}">
                        </div>
                        <div class="group range">
                            <label>Price</label>
                            <input type="number" name="price" id="ct-range" value="${o.price?Number(o.price):""}">
                        </div>
                        <div class="group type">
                            <label>Tipo</label>
                            <div class="radios rdos">
                                <label for="rd-1">
                                    <input type="radio" name="chaptertype" value="manga" id="rd-1" ${o.type=="manga"?"checked":""}>
                                    <div class="rdo">
                                        <div class="inpt"></div>
                                        <div class="name">Manga</div>
                                    </div>
                                </label>
                                <label for="rd-0">
                                    <input type="radio" name="chaptertype" value="novel" id="rd-0" ${o.type=="novel"?"checked":""}>
                                    <div class="rdo">
                                        <div class="inpt"></div>
                                        <div class="name">Novela</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                        <div class="group upload">
                            <label>Subir a</label>
                            <div class="disks rdos">
                                <label for="erdo-1">
                                    <input type="radio" name="disk" value="public" id="erdo-1" ${o.disk=="public"?"checked":""}>
                                    <div class="rdo">
                                        <div class="inpt"></div>
                                        <div class="name">Local</div>
                                    </div>
                                </label>
                                ${`
                                    <label for="erdo-2">
                                        <input type="radio" name="disk" value="ftp" id="erdo-2" ${o.disk=="ftp"?"checked":""}>
                                        <div class="rdo">
                                            <div class="inpt"></div>
                                            <div class="name">FTP</div>
                                        </div>
                                    </label>
                                `}
                                
                                ${{}.VITE_S3_HOST&&{}.VITE_S3_HOST!=""?`
                                    <label for="erdo-4">
                                        <input type="radio" name="disk" value="s3" id="erdo-4" ${o.disk=="s3"?"checked":""}>
                                        <div class="rdo">
                                            <div class="inpt"></div>
                                            <div class="name">Amazon S3</div>
                                        </div>
                                    </label>
                                `:""}
                            </div>
                        </div>
                        <div class="group ${o.type=="novel"?"":"hidden"}" id="u-novel">
                            <label for="ct-content">Contenido</label>
                            <div id="chapterContent"></div>
                        </div>
                        <div class="group ${o.type=="manga"?"":"hidden"}" id="u-manga">
                            <label for="ct-iamges">Images</label>
                            <div id="u-preview">
                                <div class="file">
                                    <div class="choose">Agregar</div>
                                    <input type="file" name="images[]" accept="image/*" multiple id="ct-images"/>
                                </div>
                                ${o.images?l.map((r,n)=>`
                                    <div class="item" id="image-${g+n}" index="${g+n}">
                                        <img src="${h+r}" alt="preview" />
                                        <div class="u-remove" data-index="${g+n}">
                                            <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                                        </div>
                                    </div>
                                `).join(""):""}
                            </div>
                        </div>
                        <!-- Modal footer -->
                        <div class="md-buttons flex items-center space-x-2">
                            <button type="submit" class="text-white bg-vo-green font-medium rounded-lg text-sm px-5 py-2.5 text-center hover:bg-vo-green-over" id="updateChapter">Guardar</button>
                        </div>
                    </form>
                </div>
            `,p.append(y);let k="";o.content&&o.content!=""&&(k=JSON.parse(o.content),k=k.replace(/\n/g,"<br>")),tinymce.init({selector:"#chapterContent",plugins:"anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount",toolbar:"undo redo | blocks fontfamily backcolor | bold italic underline strikethrough | link image table | align lineheight | numlist bullist indent outdent | emoticons charmap",menubar:!1,height:600,setup:function(r){r.on("init",function(n){r.setContent(k)})}});let T=document.querySelector("#updateChapter #ct-slug");T.addEventListener("input",function(r){T.value=F(r.target.value)});let e=[],i=["jpeg","jpg","png","gif"];const d=function(r,n){const v=document.querySelector(r);let w;v&&(w=v.nextElementSibling,w.addEventListener("change",function(b){e=[],e.push(...b.target.files),e.length>0&&(e=u(e,n),oe(e,a,o.id))}),v.addEventListener("click",()=>w.click()),v.addEventListener("dragover",b=>{b.preventDefault()}),v.addEventListener("drop",b=>{b.preventDefault(),e=[],e.push(...b.dataTransfer.files),e.length>0&&(e=u(e,n),oe(e,a,o.id))}))},u=function(r,n){let v=[];if(!r)return console.log("error, no hay archivos"),[];for(let w=0;w<r.length;w++){let b=r[w].name.split(".").pop().toLowerCase();if(!n.includes(b)){console.log(r[w].name,"Tipo de archivo no permitido");continue}v.push(r[w])}return v};d("#updateChapter #u-preview .choose",i);let m=document.querySelector("#u-preview");const $=new DgSortable(m,{draggable:".item",mirror:{constrainDimensions:!0}});Array.prototype.organizarImagenes=function(r,n){this.splice(n,0,this.splice(r,1)[0])},$.on("sortable:sorted",r=>{let n=r.data.newIndex,v=r.data.oldIndex;l.organizarImagenes(v,n)}),$.on("sortable:stop",()=>{setTimeout(()=>{let r=document.querySelectorAll("#updateChapter .md-content form .group #u-preview .item");for(let n=0;n<r.length;n++)r[n].setAttribute("id","image-"+n),r[n].setAttribute("index",n),r[n].children[1].setAttribute("data-index",n);r.length>1&&axios.post(route("actualizarOrdenChapter.imagenes",[a]),{images:l},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(n){console.log(n),Toastify({text:"Orden actualizado",className:"success",duration:2e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast()}).catch(function(n){console.log("error: ",n)})},300)});const B=function(r,n,v){var _,q,C;axios.post(route("eliminarChapter.imagenes",[v]),{index:n},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(x){console.log(x);let M=document.querySelector("#updateChapter #ct-images");e=[],M.value="",Toastify({text:"Imagen eliminada",className:"success",duration:2e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast()}).catch(function(x){console.log("error: ",x)});let w=document.querySelector("#updateChapter #u-preview #image-"+n);w==null||w.remove();let b=document.querySelectorAll("#updateChapter .md-content form .group #u-preview .item");r.splice(n,1);for(let x=0;x<r.length;x++)(_=b[x])==null||_.setAttribute("id","image-"+x),(q=b[x])==null||q.setAttribute("index",x),(C=b[x])==null||C.children[1].setAttribute("data-index",x);return r};document.addEventListener("click",function(r){if(!r.target.matches(".u-remove"))return;r.preventDefault();let n=r.target.getAttribute("data-index");l=B(l,n,o.id)}),document.addEventListener("click",function(r){r.target.matches("#updateChapter .md-close")&&(r.preventDefault(),tinymce&&tinymce.remove(),ge())}),document.addEventListener("click",function(r){if(!r.target.matches("#updateChapter .md-content form .radios label input"))return;let n=document.querySelector("#u-manga"),v=document.querySelector("#u-novel");r.target.value=="novel"&&(f(n,"hidden"),S(v,"hidden")),r.target.value=="manga"&&(f(v,"hidden"),S(n,"hidden"))}),document.addEventListener("click",async function(r){if(!r.target.matches("#updateChapter"))return;r.preventDefault();let n=document.querySelector("#updateChapter #ct-name"),v=document.querySelector("#updateChapter #ct-slug");if(n.value=="")return n.focus(),f(n,"error"),Toastify({text:"Campo nombre requerido",className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!0;if(S(n,"error"),v.value=="")return v.focus(),f(v,"error"),Toastify({text:"Campo slug requerido",className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!0;S(v,"error");let w=document.querySelector("#updateChapter .radios input:checked"),b=tinymce.get("chapterContent").getContent();if(w.value=="manga"&&e.length<1&&l.length<1)return Toastify({text:"Debes agregar una imagen por lo menos.",className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!0;if(w.value=="novel"&&b=="")return Toastify({text:"Contenido no debe ir vacio",className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!0;let _=document.querySelector("#updateChapter form"),q=new FormData(_),C=q.get("name"),x=q.get("slug"),M=q.get("chaptertype"),W=q.get("price"),X=q.get("disk");q.append("content",JSON.stringify(b));let N=q.get("content");await axios.patch(route("chapters.update",[o.id]),{name:C,slug:x,price:W,type:M,disk:X,content:N},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(E){let A=E.data;if(A.excluded&&A.excluded.forEach(z=>{Toastify({text:z,className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"bottom",position:"right"}).showToast()}),E.data.status=="success"){Toastify({text:E.data.msg,className:"success",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast();let I=document.querySelector("#m-"+a+" .name"),z=E.data.item;I.textContent=z.name}else E.data.status=="error"&&Toastify({text:E.data.msg,className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"bottom",position:"right"}).showToast();console.log(E)}).catch(function(E){console.log("error: ",E)})})}}).catch(function(c){console.log(c)})});function ge(){let t=document.getElementById("updateChapter");f(t,"clg"),S(t,"opn"),setTimeout(()=>{t.remove()},300),U()}async function oe(t,a,s){K();let c=document.querySelector("#updateChapter.modal-chapter .md-content form .upload input:checked").value,o=document.querySelector("#u-preview"),p=document.querySelector("#u-preview .item:last-of-type"),y;p?y=Number(p.getAttribute("index"))+1:y=0;for(let l=0;l<t.length;l++){let L=URL.createObjectURL(t[l]),g=document.createElement("div"),h=y+l;f(g,"item"),g.setAttribute("id","image-"+h),g.setAttribute("index",h),g.innerHTML=`
            <img src="${L}" alt="preview" />
            <div class="up-status">
                <i class="fa-solid fa-circle-notch"></i>
            </div>
            <div class="u-remove" data-index="${h}">
                <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
            </div>
        `,o.append(g)}new Promise(async(l,L)=>{const g=Object.values(t);let h=0,k=0;p&&(h=Number(p.getAttribute("index"))+1);for(const T of g){const e=document.querySelector("#image-"+h);f(e.children[1],"spin"),await axios.post(route("uploadSingle.store"),{chapter_id:s,manga_id:a,disk:c,image:T},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"multipart/form-data"}}).then(function(i){console.log(i),i.data.status=="success"&&(f(e.children[1],"uploaded"),e.children[1].innerHTML='<i class="fa-solid fa-check"></i>')}).catch(function(i){console.log("error: ",i)}),console.log(k,g.length),k===g.length-1&&l(),k++,h++}}).then(()=>{Toastify({text:"Imagenes agregadas",className:"success",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast()})}const ae=document.querySelector(".fm-manga > form");if(ae){ae.addEventListener("submit",function(a){fe()||a.preventDefault()});let t=document.querySelector("#ch-date");t&&new AirDatepicker(t,{locale:localeEs,dateFormat:"yyyy-MM-dd"})}function fe(){let t=document.querySelector(".fm-manga > form #m-name"),a=document.querySelector(".fm-manga > form #m-slug");document.querySelector(".fm-manga > form #m-altname"),document.querySelector(".fm-manga > form #m-description");let s=document.querySelector(".fm-manga > form #m-image");document.querySelector(".fm-manga > form #m-published");let c=document.querySelector(".fm-manga > form .categories .choices"),o=document.querySelector(".fm-manga > form .categories .choices .choices__input");if(document.querySelector(".fm-manga > form .tags .choices"),document.querySelector(".fm-manga > form .tags .choices .choices__input"),document.querySelector(".fm-manga > form #m-bookstatus"),document.querySelector(".fm-manga > form #m-demography"),t&&t.value=="")return t.focus(),f(t,"error"),Toastify({text:"Campo nombre requerido",className:"error",duration:2e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!1;if(t&&S(t,"error"),a&&a.value=="")return a.focus(),f(a,"error"),Toastify({text:"Campo slug requerido",className:"error",duration:2e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!1;if(a&&S(a,"error"),s&&s.value==""){let p=document.querySelector(".fm-manga > form .dropzone #choose");return f(p,"error"),setTimeout(()=>{S(p,"error")},1e3),Toastify({text:"Imagen destacada es requerida",className:"error",duration:2e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!1}else s&&S(s,"error");return c&&o.value==""?(o.focus(),f(c,"error"),Toastify({text:"Campo descripcion requerido",className:"error",duration:2e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!1):(c&&S(c,"error"),!0)}
