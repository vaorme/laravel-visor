import{d as oe,r as Y,c as O,M as re}from"./helpers-c1bfa4e6.js";import{s as I}from"./helpers-557a48c5.js";let ae=["jpg","jpeg","png","webp","gif"];oe(".fm-manga .dropzone #choose",ae);const M={silent:!0,allowHTML:!0,removeItems:!0,removeItemButton:!0,searchEnabled:!1,searchFloor:1,position:"auto",resetScrollPosition:!0,searchResultLimit:2,searchFields:["label","value"],duplicateItemsAllowed:!1,addItemText:e=>`Presiona Enter para añadir <b>"${e}"</b>`,position:"auto",loadingText:"Cargando...",noResultsText:"No se han encontrado resultados",noChoicesText:"No hay opciones para elegir",itemSelectText:"Presione para seleccionar",uniqueItemText:"Solo se pueden agregar valores únicos",customAddItemText:"Solo se pueden agregar valores que coincidan con condiciones específicas"},ee={header:{class:EditorJsHeader,inlineToolbar:!0},list:EditorJsList,table:EditorJsTable,checklist:EditorJsChecklist,underline:{class:EditorJsUnderline,inlineToolbar:!0},raw:EditorJsRaw,quote:{class:EditorJsQuote,inlineToolbar:!0},inlineCode:EditorJsInlineCode,embed:EditorJsEmbed,code:EditorJsCode,warning:EditorJsWarning,image:EditorJsSimpleImage,Color:{class:EditorJsColor,config:{colorCollections:["#EC7878","#9C27B0","#673AB7","#3F51B5","#0070FF","#03A9F4","#00BCD4","#4CAF50","#8BC34A","#CDDC39","#FFF"],defaultColor:"#FF1300",type:"text",customPicker:!0}},Marker:{class:EditorJsColor,config:{defaultColor:"#FFBF00",type:"marker",icon:'<svg fill="#000000" height="200px" width="200px" version="1.1" id="Icons" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" xml:space="preserve"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <path d="M17.6,6L6.9,16.7c-0.2,0.2-0.3,0.4-0.3,0.6L6,23.9c0,0.3,0.1,0.6,0.3,0.8C6.5,24.9,6.7,25,7,25c0,0,0.1,0,0.1,0l6.6-0.6 c0.2,0,0.5-0.1,0.6-0.3L25,13.4L17.6,6z"></path> <path d="M26.4,12l1.4-1.4c1.2-1.2,1.1-3.1-0.1-4.3l-3-3c-0.6-0.6-1.3-0.9-2.2-0.9c-0.8,0-1.6,0.3-2.2,0.9L19,4.6L26.4,12z"></path> </g> <g> <path d="M28,29H4c-0.6,0-1-0.4-1-1s0.4-1,1-1h24c0.6,0,1,0.4,1,1S28.6,29,28,29z"></path> </g> </g></svg>'}}},j=document.querySelector("#m-tags"),H=document.querySelector("#m-categories"),P=document.querySelector("#m-mangatype"),K=document.querySelector("#m-bookstatus"),X=document.querySelector("#m-demography");j&&H&&P&&K&&X&&(new Choices(j,M),new Choices(H,M),new Choices(P,M),new Choices(K,M),new Choices(X,M));let ne=document.querySelector("#field-date");ne&&new AirDatepicker("#field-date",{locale:localeEs,dateFormat:"yyyy-MM-dd"});let ie=document.querySelector(".fm-create");if(ie){let e=document.querySelector("#m-name"),r=document.querySelector("#m-slug");e.addEventListener("input",function(t){r.value=I(t.target.value)}),r.addEventListener("input",function(t){r.value=I(t.target.value)})}let le=document.querySelector(".fm-update");if(le){let e=document.querySelector("#m-slug");e.addEventListener("input",function(r){e.value=I(r.target.value)})}let _=document.getElementById("modalChapter");if(_){let e=document.querySelector("#ct-name"),r=document.querySelector("#ct-slug");document.querySelector("#ct-images"),document.querySelectorAll('#modalChapter form input[name="chaptertype"]');let t;document.querySelector("main.main .box .frmo.fm-manga .main .section.chapters .buttons a#ct-chapter").addEventListener("click",function(i){i.preventDefault(),t=new EditorJS({holder:"createChapterContent",tools:ee}),_.addClass("opn"),Y()}),document.addEventListener("click",function(i){i.target.matches("#modalChapter .md-close")&&(i.preventDefault(),t.destroy(),_.addClass("clg"),_.removeClass("opn"),O())});let o=document.querySelector("#t-preview"),s=document.querySelectorAll("main.main .box #modalChapter .md-content form .group .radios label input"),w=document.querySelector("#t-manga"),v=document.querySelector("#t-novel");s.forEach(i=>{i.addEventListener("click",function(d){d.target.value=="novel"&&(w.addClass("hidden"),v.removeClass("hidden")),d.target.value=="manga"&&(v.addClass("hidden"),w.removeClass("hidden"))})});let S=document.querySelector("#modalChapter form");e.addEventListener("input",function(i){r.value=I(i.target.value)}),r.addEventListener("input",function(i){r.value=I(i.target.value)});let c=[],k=["jpeg","jpg","png","gif"];const T=function(i,d){const p=document.querySelector(i);let m;p&&(m=p.nextElementSibling,m.addEventListener("change",function(u){c.push(...u.target.files),c.length>0&&(c=b(c,d),U(c),console.log(c))}),p.addEventListener("click",()=>m.click()),p.addEventListener("dragover",u=>{u.preventDefault()}),p.addEventListener("drop",u=>{u.preventDefault(),c.push(...u.dataTransfer.files),c.length>0&&(c=b(c,d),U(c))}))},b=function(i,d){let p=[];if(!i)return console.log("error, no hay archivos"),[];for(let m=0;m<i.length;m++){let u=i[m].name.split(".").pop().toLowerCase();if(!d.includes(u)){console.log(i[m].name,"Tipo de archivo no permitido");continue}p.push(i[m])}return p};T("#modalChapter #t-preview .choose",k);const A=new DgSortable(o,{draggable:".item",mirror:{constrainDimensions:!0}});Array.prototype.movePreview=function(i,d){console.log(this),this.splice(d,0,this.splice(i,1)[0]);for(let p=0;p<this.length;p++){let m=this[p].name.split("."),u=Date.now()+p;m[0].replace(/[0-9-]/g,`${p}-`),this[p]=new File([this[p]],`${p}-${u}.${m[1]}`)}},A.on("sortable:sorted",i=>{let d=i.data.newIndex,p=i.data.oldIndex;c.movePreview(p,d),console.log(c)}),A.on("sortable:stop",()=>{setTimeout(()=>{let i=document.querySelectorAll("#modalChapter .md-content form .group #t-preview .item");for(let d=0;d<i.length;d++)i[d].setAttribute("id","image-"+d),i[d].setAttribute("index",d),i[d].children[1].setAttribute("data-index",d)},300)});const f=function(i,d){document.querySelector("#image-"+d).remove();let m=document.querySelectorAll("#modalChapter .md-content form .group #t-preview .item");i.splice(d,1);for(let u=0;u<i.length;u++){let F=i[u].name.split("."),n=Date.now()+u;F[0].replace(/[0-9-]/g,`${u}-`),m[u].setAttribute("id","image-"+u),m[u].setAttribute("index",u),m[u].children[1].setAttribute("data-index",u),i[u]=new File([i[u]],`${u}-${n}.${F[1]}`)}return i};document.addEventListener("click",function(i){if(!i.target.matches(".c-remove"))return;i.preventDefault();let d=i.target.getAttribute("data-index");c=f(c,d)}),S.addEventListener("submit",async function(i){if(i.preventDefault(),e.value=="")return e.focus(),e.addClass("error"),Toastify({text:"Campo nombre requerido",className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!0;if(e.removeClass("error"),r.value=="")return r.focus(),r.addClass("error"),Toastify({text:"Campo slug requerido",className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!0;r.removeClass("error");let d=document.querySelector("#modalChapter form"),p=document.querySelector(".fm-manga form .chapters .list .simplebar-content"),m=new FormData(d),u=m.get("_token"),F=m.get("name"),n=m.get("slug"),l=m.get("disk"),g=m.get("chaptertype"),y=m.get("price"),x="";await t.save().then(h=>h).then(h=>{x=h}).catch(h=>{console.log("Saving failed: ",h)});let D=document.querySelector("#modalChapter .radios input:checked");if(D.value=="manga"){if(c.length<1)return Toastify({text:"Debes agregar una imagen por lo menos.",className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!0}else if(D.value=="novel"&&x.blocks.length<1)return Toastify({text:"Debes agregar contenido por lo menos.",className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!0;m.append("content",JSON.stringify(x));let L=m.get("content");await axios.post(d.action,{_token:u,name:F,slug:n,price:y,disk:l,chaptertype:g,content:L,images:c},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"multipart/form-data"}}).then(function(h){let C=h.data;if(C.excluded&&C.excluded.forEach($=>{Toastify({text:$,className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"bottom",position:"right"}).showToast()}),h.data.status=="success"){Toastify({text:h.data.msg,className:"success",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast();let N=h.data.item,$=h.data.manga_slug,B=document.createElement("div");B.classList.add("item"),B.setAttribute("id","m-"+N.id),B.innerHTML=`
                    <div class="name">
                        ${N.name}
                    </div>
                    <div class="actions">
                        <a href="${route("chapter_viewer.index",{manga_slug:$,chapter_slug:N.slug})}" data-id="${N.id}" class="botn view" target="_blank">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-player-play" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M7 4v16l13 -8z" />
                            </svg>
                        </a>
                        <a href="#" data-id="${N.id}" class="botn edit">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-pencil" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
                                <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
                            </svg>
                        </a>
                        <a href="#" data-id="${N.id}" class="botn delete">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-trash" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <line x1="4" y1="7" x2="20" y2="7" />
                                <line x1="10" y1="11" x2="10" y2="17" />
                                <line x1="14" y1="11" x2="14" y2="17" />
                                <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" />
                                <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
                            </svg>
                        </a>
                    </div>
                `,p.append(B),setTimeout(function(){c=[],z(),O(),d.reset(),_.removeClass("opn")},1e3)}else h.data.status=="error"&&Toastify({text:h.data.msg,className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"bottom",position:"right"}).showToast();console.log(h)}).catch(function(h){console.log("error: ",h)})})}function U(e){z();let r=document.querySelector("#t-preview"),t=document.querySelector("#t-preview .item:last-of-type"),a;t?a=Number(t.getAttribute("index"))+1:a=0;for(let o=0;o<e.length;o++){let s=URL.createObjectURL(e[o]),w=document.createElement("div"),v=a+o;w.addClass("item"),w.setAttribute("id","image-"+v),w.setAttribute("index",v),w.innerHTML=`
            <img src="${s}" alt="preview" />
            <div class="c-remove" data-index="${v}">
                <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
            </div>
        `,r.append(w)}}function z(){let e=document.querySelectorAll("#t-preview .item");e&&e.forEach(r=>{r.remove()})}const G=document.querySelector(".frmo.fm-manga .main .section.chapters .buttons a#popup-chapter");if(G){const e=document.querySelector(".frmo.fm-manga .main .section.chapters .chapter__upload");G.addEventListener("click",function(r){r.preventDefault(),slideToggle(e)})}let se=["zip"];ce(".fm-manga .upload #upload-chapter",se);function ce(e,r){const t=document.querySelector(e);let a;t&&(a=t.nextElementSibling,a.addEventListener("change",function(o){const s=this.files[0];V(s,r)}),t.addEventListener("click",()=>a.click()),t.addEventListener("dragover",o=>{o.preventDefault()}),t.addEventListener("drop",o=>{o.preventDefault(),console.log(o.dataTransfer.files);const s=o.dataTransfer.files[0];V(s,r)}))}function V(e,r){if(!e)return console.log("error, no hay archivo"),"error";let t=e.name.split(".").pop().toLowerCase();if(!r.includes(t))return alert("Tipo de archivo no permitido"),"no allowed";let o=document.querySelector("#inpt-chapter").getAttribute("data-id"),s=new FormData,w=document.querySelector(".fm-manga form .chapters .list .simplebar-content"),v=document.querySelector(".frmo.fm-manga .main .section.chapters .chapter__upload .disks input:checked");s.set("disk",v.value),s.append("chapters",e),axios.post(route("uploadChapter.store",[o]),s,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(S){console.log(S);let c=S.data;c.excluded&&c.excluded.forEach(b=>{Toastify({text:b,className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"bottom",position:"right"}).showToast()});let k=c.created;if(k)k.forEach(T=>{Toastify({text:T.msg,className:"success",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast()}),k.forEach(T=>{let b=T.item,A=T.manga_slug,f=document.createElement("div");f.classList.add("item"),f.setAttribute("id","m-"+b.id),f.innerHTML=`
                    <div class="name">
                        ${b.name}
                    </div>
                    <div class="actions">
                        <a href="${route("chapter_viewer.index",{manga_slug:A,chapter_slug:b.slug})}" data-id="${b.id}" class="botn view" target="_blank">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-player-play" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M7 4v16l13 -8z" />
                            </svg>
                        </a>
                        <a href="#" data-id="${b.id}" class="botn edit">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-pencil" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
                                <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
                            </svg>
                        </a>
                        <a href="#" data-id="${b.id}" class="botn delete">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-trash" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <line x1="4" y1="7" x2="20" y2="7" />
                                <line x1="10" y1="11" x2="10" y2="17" />
                                <line x1="14" y1="11" x2="14" y2="17" />
                                <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" />
                                <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
                            </svg>
                        </a>
                    </div>
                `,w.append(f)});else{let T=S.data.error;T&&T.forEach(b=>{Toastify({text:b,className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"bottom",position:"right"}).showToast()})}document.querySelector("#inpt-chapter").value=""}).catch(function(S){console.log(S)})}let E=new re;document.addEventListener("click",function(e){if(!e.target.matches(".mangaDelete"))return;e.preventDefault();let r=e.target.getAttribute("data-id");E.fire({type:"warning",title:"Seguro que deseas eliminar?",text:"¡No podrás revertir esto!",confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.confirmed&&axios.delete(route("manga.destroy",[r]),{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(a){Toastify({text:a.data.msg,className:"success",duration:1e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast();let o=document.querySelector(".alertify"),s=document.querySelector(".al-overlay");E.close(o,s),setTimeout(()=>{window.location.href=route("manga.index")},1e3)}).catch(function(a){console.log(a)})}).catch(t=>{console.log(t)})});document.querySelectorAll("main.main .box .frmo.fm-manga .main .section.chapters .list .item .actions .botn.delete");document.addEventListener("click",function(e){if(!e.target.matches(".botn.delete"))return;e.preventDefault();let r=e.target.getAttribute("data-id");E.fire({type:"warning",title:"Eliminar capítulo?",text:"¡No podrás revertir esto!",confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.confirmed&&axios.delete(route("chapters.destroy",[r]),{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(a){Toastify({text:a.data.msg,className:"success",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast();let o=document.querySelector(".alertify"),s=document.querySelector(".al-overlay");E.close(o,s),document.querySelector("#m-"+a.data.id).remove()}).catch(function(a){console.log(a)})}).catch(t=>{console.log(t)})});document.addEventListener("click",function(e){if(!e.target.matches(".botn.edit"))return;e.preventDefault();let r=e.target.getAttribute("data-id"),t=document.querySelector('meta[name="csrf-token"]').getAttribute("content");axios.post(route("chapters.show",[r]),{headers:{"X-CSRF-TOKEN":t}}).then(function(a){if(Y(),a.status==200){let{chapter:o}=a.data,s=document.querySelector(".main.main .box"),w=document.createElement("div");const v=o.disk;let S=[];o.images&&(S=JSON.parse(o.images));let c=document.querySelector("#u-preview .item:last-of-type"),k;c?k=Number(c.getAttribute("index"))+1:k=0,w.setAttribute("id","updateChapter"),w.addClass("modal-chapter opn");let T;switch(v){case"ftp":T="";break;case"sftp":T={}.VITE_SFTP_URL;break;case"s3":T={}.VITE_S3_URL;break;default:T="http://localhost:8000/storage/";break}w.innerHTML=`
                <div class="md-title">
                    <h4>Actualizar capítulo</h4>
                    <div class="md-close">
                        <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                    </div>
                </div>
                <div class="md-content">
                    <form action="${route("chapters.update",[o.id])}" method="post" enctype="multipart/form-data">
                        <input type="hidden" name="_token" value="${t}">
                        <div class="group">
                            <label for="ct-name">Name</label>
                            <input type="text" name="name" id="ct-name" value="${o.name}">
                        </div>
                        <div class="group">
                            <label for="ct-slug">Slug</label>
                            <input type="text" name="slug" id="ct-slug" value="${o.slug}">
                        </div>
                        <div class="group range">
                            <label>Price</label>
                            <input type="number" name="price" id="ct-range" value="${o.price?Number(o.price):""}">
                        </div>
                        <div class="group type">
                            <label>Tipo</label>
                            <div class="radios rdos">
                                <label for="rd-1">
                                    <input type="radio" name="chaptertype" value="manga" id="rd-1" ${o.type=="manga"?"checked":""}>
                                    <div class="rdo">
                                        <div class="inpt"></div>
                                        <div class="name">Manga</div>
                                    </div>
                                </label>
                                <label for="rd-0">
                                    <input type="radio" name="chaptertype" value="novel" id="rd-0" ${o.type=="novel"?"checked":""}>
                                    <div class="rdo">
                                        <div class="inpt"></div>
                                        <div class="name">Novela</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                        <div class="group upload">
                            <label>Subir a</label>
                            <div class="disks rdos">
                                <label for="erdo-1">
                                    <input type="radio" name="disk" value="public" id="erdo-1" ${o.disk=="public"?"checked":""}>
                                    <div class="rdo">
                                        <div class="inpt"></div>
                                        <div class="name">Local</div>
                                    </div>
                                </label>
                                
                                
                                ${{}.VITE_S3_HOST&&{}.VITE_S3_HOST!=""?`
                                    <label for="erdo-4">
                                        <input type="radio" name="disk" value="s3" id="erdo-4" ${o.disk=="s3"?"checked":""}>
                                        <div class="rdo">
                                            <div class="inpt"></div>
                                            <div class="name">Amazon S3</div>
                                        </div>
                                    </label>
                                `:""}
                            </div>
                        </div>
                        <div class="group ${o.type=="novel"?"":"hidden"}" id="u-novel">
                            <label for="ct-content">Contenido</label>
                            <div id="chapterContent"></div>
                        </div>
                        <div class="group ${o.type=="manga"?"":"hidden"}" id="u-manga">
                            <label for="ct-iamges">Images</label>
                            <div id="u-preview">
                                <div class="file">
                                    <div class="choose">Agregar</div>
                                    <input type="file" name="images[]" accept="image/*" multiple id="ct-images"/>
                                </div>
                                ${o.images?S.map((n,l)=>`
                                    <div class="item" id="image-${k+l}" index="${k+l}">
                                        <img src="${T+n}" alt="preview" />
                                        <div class="u-remove" data-index="${k+l}">
                                            <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                                        </div>
                                    </div>
                                `).join(""):""}
                            </div>
                        </div>
                        <!-- Modal footer -->
                        <div class="md-buttons flex items-center space-x-2">
                            <button type="submit" class="text-white bg-vo-green font-medium rounded-lg text-sm px-5 py-2.5 text-center hover:bg-vo-green-over" id="updateChapter">Guardar</button>
                        </div>
                    </form>
                </div>
            `,s.append(w);const b=new EditorJS({holder:"chapterContent",tools:ee});if(o.content){let n=JSON.parse(o.content);n.blocks.length>0&&setTimeout(()=>{b.blocks.render(n)},1e3)}let A=document.querySelector("#updateChapter #ct-slug");A.addEventListener("input",function(n){A.value=I(n.target.value)});let f=[],i=["jpeg","jpg","png","gif"];const d=function(n,l){const g=document.querySelector(n);let y;g&&(y=g.nextElementSibling,y.addEventListener("change",function(x){f=[],f.push(...x.target.files),f.length>0&&(f=p(f,l),Z(f,r,o.id))}),g.addEventListener("click",()=>y.click()),g.addEventListener("dragover",x=>{x.preventDefault()}),g.addEventListener("drop",x=>{x.preventDefault(),f=[],f.push(...x.dataTransfer.files),f.length>0&&(f=p(f,l),Z(f,r,o.id))}))},p=function(n,l){let g=[];if(!n)return console.log("error, no hay archivos"),[];for(let y=0;y<n.length;y++){let x=n[y].name.split(".").pop().toLowerCase();if(!l.includes(x)){console.log(n[y].name,"Tipo de archivo no permitido");continue}g.push(n[y])}return g};d("#updateChapter #u-preview .choose",i);let m=document.querySelector("#u-preview");const u=new DgSortable(m,{draggable:".item",mirror:{constrainDimensions:!0}});Array.prototype.organizarImagenes=function(n,l){this.splice(l,0,this.splice(n,1)[0])},u.on("sortable:sorted",n=>{let l=n.data.newIndex,g=n.data.oldIndex;S.organizarImagenes(g,l)}),u.on("sortable:stop",()=>{setTimeout(()=>{let n=document.querySelectorAll("#updateChapter .md-content form .group #u-preview .item");for(let l=0;l<n.length;l++)n[l].setAttribute("id","image-"+l),n[l].setAttribute("index",l),n[l].children[1].setAttribute("data-index",l);n.length>1&&axios.post(route("actualizarOrdenChapter.imagenes",[r]),{images:S},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(l){console.log(l),Toastify({text:"Orden actualizado",className:"success",duration:2e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast()}).catch(function(l){console.log("error: ",l)})},300)});const F=function(n,l,g){var D,L,h;axios.post(route("eliminarChapter.imagenes",[g]),{index:l},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(C){console.log(C);let N=document.querySelector("#updateChapter #ct-images");f=[],N.value="",Toastify({text:"Imagen eliminada",className:"success",duration:2e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast()}).catch(function(C){console.log("error: ",C)});let y=document.querySelector("#updateChapter #u-preview #image-"+l);y==null||y.remove();let x=document.querySelectorAll("#updateChapter .md-content form .group #u-preview .item");n.splice(l,1);for(let C=0;C<n.length;C++)(D=x[C])==null||D.setAttribute("id","image-"+C),(L=x[C])==null||L.setAttribute("index",C),(h=x[C])==null||h.children[1].setAttribute("data-index",C);return n};document.addEventListener("click",function(n){if(!n.target.matches(".u-remove"))return;n.preventDefault();let l=n.target.getAttribute("data-index");S=F(S,l,o.id)}),document.addEventListener("click",function(n){n.target.matches("#updateChapter .md-close")&&(n.preventDefault(),b&&b.destroy(),de())}),document.addEventListener("click",function(n){if(!n.target.matches("#updateChapter .md-content form .radios label input"))return;let l=document.querySelector("#u-manga"),g=document.querySelector("#u-novel");n.target.value=="novel"&&(l.addClass("hidden"),g.removeClass("hidden")),n.target.value=="manga"&&(g.addClass("hidden"),l.removeClass("hidden"))}),document.addEventListener("click",async function(n){if(!n.target.matches("#updateChapter"))return;n.preventDefault();let l=document.querySelector("#updateChapter #ct-name"),g=document.querySelector("#updateChapter #ct-slug");if(l.value=="")return l.focus(),l.addClass("error"),Toastify({text:"Campo nombre requerido",className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!0;if(l.removeClass("error"),g.value=="")return g.focus(),g.addClass("error"),Toastify({text:"Campo slug requerido",className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!0;g.removeClass("error");let y="",x=document.querySelector("#updateChapter .radios input:checked");if(x.value=="manga"&&f.length<1&&S.length<1)return Toastify({text:"Debes agregar una imagen por lo menos.",className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!0;if(x.value=="novel"&&y.blocks&&y.blocks.length<1)return Toastify({text:"Debes agregar contenido por lo menos.",className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!0;await b.save().then(q=>q).then(q=>{y=q}).catch(q=>{console.log("Saving failed: ",q)});let D=document.querySelector("#updateChapter form"),L=new FormData(D),h=L.get("name"),C=L.get("slug"),N=L.get("chaptertype"),$=L.get("price"),B=L.get("disk");L.append("content",JSON.stringify(y));let te=L.get("content");await axios.patch(route("chapters.update",[o.id]),{name:h,slug:C,price:$,type:N,disk:B,content:te},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(q){let J=q.data;if(J.excluded&&J.excluded.forEach(R=>{Toastify({text:R,className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"bottom",position:"right"}).showToast()}),q.data.status=="success"){Toastify({text:q.data.msg,className:"success",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast();let W=document.querySelector("#m-"+r+" .name"),R=q.data.item;W.textContent=R.name}else q.data.status=="error"&&Toastify({text:q.data.msg,className:"error",duration:5e3,newWindow:!0,close:!0,gravity:"bottom",position:"right"}).showToast();console.log(q)}).catch(function(q){console.log("error: ",q)})})}}).catch(function(a){console.log(a)})});function de(){let e=document.getElementById("updateChapter");e.addClass("clg"),e.removeClass("opn"),setTimeout(()=>{e.remove()},300),O()}function Z(e,r,t){z();let a=document.querySelector("#updateChapter.modal-chapter .md-content form .upload input:checked").value;axios.post(route("subirChapter.imagenes",[r]),{images:e,chapterid:t,disk:a},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"multipart/form-data"}}).then(function(v){console.log(v),Toastify({text:v.data.msg,className:"success",duration:5e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast()}).catch(function(v){console.log("error: ",v)});let o=document.querySelector("#u-preview"),s=document.querySelector("#u-preview .item:last-of-type"),w;s?w=Number(s.getAttribute("index"))+1:w=0;for(let v=0;v<e.length;v++){let S=URL.createObjectURL(e[v]),c=document.createElement("div"),k=w+v;c.addClass("item"),c.setAttribute("id","image-"+k),c.setAttribute("index",k),c.innerHTML=`
            <img src="${S}" alt="preview" />
            <div class="u-remove" data-index="${k}">
                <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
            </div>
        `,o.append(c)}}const Q=document.querySelector(".fm-manga > form");if(Q){Q.addEventListener("submit",function(r){ue()||r.preventDefault()});let e=document.querySelector("#ch-date");e&&new AirDatepicker(e,{locale:localeEs,dateFormat:"yyyy-MM-dd"})}function ue(){let e=document.querySelector(".fm-manga > form #m-name"),r=document.querySelector(".fm-manga > form #m-slug");document.querySelector(".fm-manga > form #m-altname"),document.querySelector(".fm-manga > form #m-description");let t=document.querySelector(".fm-manga > form #m-image");document.querySelector(".fm-manga > form #m-published");let a=document.querySelector(".fm-manga > form .categories .choices"),o=document.querySelector(".fm-manga > form .categories .choices .choices__input");if(document.querySelector(".fm-manga > form .tags .choices"),document.querySelector(".fm-manga > form .tags .choices .choices__input"),document.querySelector(".fm-manga > form #m-bookstatus"),document.querySelector(".fm-manga > form #m-demography"),e&&e.value=="")return e.focus(),e.addClass("error"),Toastify({text:"Campo nombre requerido",className:"error",duration:2e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!1;if(e&&e.removeClass("error"),r&&r.value=="")return r.focus(),r.addClass("error"),Toastify({text:"Campo slug requerido",className:"error",duration:2e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!1;if(r&&r.removeClass("error"),t&&t.value==""){let s=document.querySelector(".fm-manga > form .dropzone #choose");return s.addClass("error"),setTimeout(()=>{s.removeClass("error")},1e3),Toastify({text:"Imagen destacada es requerida",className:"error",duration:2e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!1}else t&&t.removeClass("error");return a&&o.value==""?(o.focus(),a.addClass("error"),Toastify({text:"Campo descripcion requerido",className:"error",duration:2e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast(),!1):(a&&a.removeClass("error"),!0)}document.addEventListener("click",function(e){if(!e.target.matches(".mangaTypeDelete"))return;e.preventDefault();let r=e.target.getAttribute("data-id");E.fire({type:"warning",title:"Seguro que deseas eliminar?",text:"¡No podrás revertir esto!",confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.confirmed&&axios.delete(route("manga_types.destroy",[r]),{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(a){Toastify({text:a.data.msg,className:"success",duration:1e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast();let o=document.querySelector(".alertify"),s=document.querySelector(".al-overlay");E.close(o,s),setTimeout(()=>{window.location.href=route("manga_types.index")},1e3)}).catch(function(a){console.log(a)})}).catch(t=>{console.log(t)})});document.addEventListener("click",function(e){if(!e.target.matches(".mangaStatusDelete"))return;e.preventDefault();let r=e.target.getAttribute("data-id");E.fire({type:"warning",title:"Seguro que deseas eliminar?",text:"¡No podrás revertir esto!",confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.confirmed&&axios.delete(route("manga_book_status.destroy",[r]),{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(a){Toastify({text:a.data.msg,className:"success",duration:1e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast();let o=document.querySelector(".alertify"),s=document.querySelector(".al-overlay");E.close(o,s),setTimeout(()=>{window.location.href=route("manga_book_status.index")},1e3)}).catch(function(a){console.log(a)})}).catch(t=>{console.log(t)})});document.addEventListener("click",function(e){if(!e.target.matches(".mangaDemographyDelete"))return;e.preventDefault();let r=e.target.getAttribute("data-id");E.fire({type:"warning",title:"Seguro que deseas eliminar?",text:"¡No podrás revertir esto!",confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.confirmed&&axios.delete(route("manga_demography.destroy",[r]),{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(a){Toastify({text:a.data.msg,className:"success",duration:1e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast();let o=document.querySelector(".alertify"),s=document.querySelector(".al-overlay");E.close(o,s),setTimeout(()=>{window.location.href=route("manga_demography.index")},1e3)}).catch(function(a){console.log(a)})}).catch(t=>{console.log(t)})});document.addEventListener("click",function(e){if(!e.target.matches(".categoriesDelete"))return;e.preventDefault();let r=e.target.getAttribute("data-id");E.fire({type:"warning",title:"Seguro que deseas eliminar?",text:"¡No podrás revertir esto!",confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.confirmed&&axios.delete(route("categories.destroy",[r]),{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(a){Toastify({text:a.data.msg,className:"success",duration:1e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast();let o=document.querySelector(".alertify"),s=document.querySelector(".al-overlay");E.close(o,s),setTimeout(()=>{window.location.href=route("categories.index")},1e3)}).catch(function(a){console.log(a)})}).catch(t=>{console.log(t)})});document.addEventListener("click",function(e){if(!e.target.matches(".tagsDelete"))return;e.preventDefault();let r=e.target.getAttribute("data-id");E.fire({type:"warning",title:"Seguro que deseas eliminar?",text:"¡No podrás revertir esto!",confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.confirmed&&axios.delete(route("tags.destroy",[r]),{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(a){Toastify({text:a.data.msg,className:"success",duration:1e3,newWindow:!0,close:!0,gravity:"top",position:"center"}).showToast();let o=document.querySelector(".alertify"),s=document.querySelector(".al-overlay");E.close(o,s),setTimeout(()=>{window.location.href=route("tags.index")},1e3)}).catch(function(a){console.log(a)})}).catch(t=>{console.log(t)})});
